<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.8/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <script src="https://cdn.datatables.net/1.10.8/js/jquery.dataTables.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.8/js/dataTables.bootstrap.min.js"></script>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script> 
        <script >
            /*
             function watchCurrentPosition() {
             var positionTimer = navigator.geolocation.watchPosition(
             function (position) {
             var latitude = position.coords.latitude;
             var longitude = position.coords.longitude;
             var accuracy = position.coords.accuracy;
             var velocidad = parseInt((position.coords.speed) * 3.6);//Esto porque?
             //var capa = document.getElementById("capa");
             //Punto = CompararPuntosControl(latitude, longitude);
             //if (accuracy <= 30) {
             setMarkerPosition(currentPositionMarker, position);
             //capa.innerHTML = "latitud: " + latitude + " longitud: " + longitude + "Velocidad: " + velocidad + " <h1>Punto: " + Punto + " PuntoOld: " + PuntoOld + "</h1>";
             
             }, function error(msg) {
             alert('Please enable your GPS position future.');
             }, 
             {maximumAge: 0, 
             timeout: 3000, 
             enableHighAccuracy: true}
             );
             }*/
            ﻿var PosicionGPS = (function () {
                var Pos = {
                    Longitud: null,
                    Latitud: null
                };
                var iniciar;
                function localizame() {
                    if (navigator.geolocation) { /* Si el navegador tiene geolocalizacion */
                        navigator.geolocation.getCurrentPosition(coordenadas, errores);
                    } else {
                        alert('Oops! Tu navegador no soporta geolocalización. Bájate Chrome, que es gratis!');
                    }
                }
                function coordenadas(position) {
                    Pos.Latitud = position.coords.latitude; /*Guardamos nuestra latitud*/
                    Pos.Longitud = position.coords.longitude; /*Guardamos nuestra longitud*/
                    Pos.Presicion = position.coords.accuracy;
                    Pos.Velocidad = parseInt((position.coords.speed) * 3.6); //Esto porque?
                    iniciar(Pos);
                }
                function errores(err) {
                    /*Controlamos los posibles errores */
                    if (err.code == 0) {
                        alert("Oops! Algo ha salido mal");
                    }
                    if (err.code == 1) {
                        alert("Oops! No has aceptado compartir tu posición");
                    }
                    if (err.code == 2) {
                        alert("Oops! No se puede obtener la posición actual");
                    }
                    if (err.code == 3) {
                        alert("Oops! Hemos superado el tiempo de espera");
                    }
                }
                return {
                    Obtener: function (init) {
                        iniciar = init;
                        localizame(init);
                    }
                };
            }());
            PosicionGPS.Obtener(function (Pos) {
                cargarMapa(Pos);
                alert("XX" + JSON.stringify(Pos));
                alert("Ya se obtuvó las coordenadas");
            });
            function cargarMapa(Pos) {
                var latitud = Pos.Latitud;
                var longitud = Pos.Longitud;

                var latlon = new google.maps.LatLng(latitud, longitud); /* Creamos un punto con nuestras coordenadas */
                var myOptions = {
                    zoom: 17,
                    center: latlon, /* Definimos la posicion del mapa con el punto */
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                }; /*Configuramos una serie de opciones como el zoom del mapa y el tipo.*/
                map = new google.maps.Map($("#map_canvas").get(0), myOptions); /*Creamos el mapa y lo situamos en su capa */

                var coorMarcador = new google.maps.LatLng(latitud, longitud); //Un nuevo punto con nuestras coordenadas para el marcador (flecha) */

                var marcador = new google.maps.Marker({
                    /*Creamos un marcador*/
                    position: coorMarcador, /*Lo situamos en nuestro punto */
                    draggable: true,
                    map: map, /* Lo vinculamos a nuestro mapa */
                    title: "Dónde estoy?"
                });
                
                map.addListener('click', function() {
                    map.setZoom(8);
                    map.setCenter(marker.getPosition());
                });
            }
            //http://jafrancov.com/2010/08/bases-gmaps-api-v3/
            function load() {
                if (GBrowserIsCompatible()) {
                    var map = new GMap2(document.getElementById("#map_canvas"));
                    map.setCenter(new GLatLng(40, -4), 3);
                    map.addControl(new GLargeMapControl());
                    map.setMapType(G_NORMAL_MAP);

                    var point = new GPoint(-4, 40);
                    var marker = new GMarker(point);
                    map.addOverlay(marker);

                    GEvent.addListener(map, "click", function (overlay, point) {
                        if (point) {
                            marker.setPoint(point);
                        }
                    });
                }
            }
            window.onload=load;
        </script>
    </head>
    <body>
        <form id="frmUser">

            <div class="container">
                <div class="col-md-6">

                    <div class="form-group">
                        <label for="txtId">Id</label>
                        <input type="text" id="txtId" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="txtNom">Nombre</label>
                        <input type="text" id="txtNom" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="txtApe">Apellido</label>
                        <input type="text" id="txtApe" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="txtLtd">Latitud</label>
                        <input type="text" id="txtLtd" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="txtLng">Longitud</label>
                        <input type="text" id="txtLng" class="form-control">
                    </div>
                    <div class="row">
                        <div class="col-md-2">
                            <button type="button" id="BtnAdd" class="btn btn-default">Add</button>
                        </div>
                    </div>

                </div>
                <div class="col-md-6">
                    <div id='map_canvas' style='width:100%; height:400px;'></div>    
                </div>
            </div>

        </form>
        <script>

            $(document).ready(function () {

                function Inicializar() {


                }
                $("#BtnAdd").click(function () {
                    var formData = $("#frmUser");
                    var data = getFormData(formData);
                    console.log(JSON.stringify(data));
                    //enviarPOST();
                    //enviarGET();
                });
                //enviarGET();
                function enviarGET() {
                    $.ajax({
                        url: '/Ejemplo1/usuarios',
                        type: 'GET',
                        dataType: 'json',
                        contentType: "application/json;charset=utf-8",
                        success: function (users) {
                            //alert(JSON.stringify(users));
                            $("#bodyTable").empty();
                            $.each(users, function (index, user) {
                                $("#bodyTable").append(
                                        "<tr><td>" + user.id +
                                        "</td><td> " + user.nombre +
                                        "</td><td>" + user.apellidos + "</td>\n\
                                         <td></td></tr>"
                                        );
                            });
                            //$('#table_id').dataTable();
                        },
                        error: function (x, y, z) {
                            alert(x + '\n' + y + '\n' + z);
                        }
                    });
                }
                function enviarPOST() {

                    var usuario = {
                        id: $("#txtId").val(),
                        nombre: $("#txtNom").val(),
                        apellidos: $("#txtApe").val(),
                        telefono: '3188780177'
                    };
                    $.ajax({
                        url: '/Ejemplo1/usuarios',
                        type: 'POST',
                        data: JSON.stringify(usuario),
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            alert(data);
                            //$('#table_id').dataTable();
                        },
                        error: function (x, y, z) {
                            alert(x + '\n' + y + '\n' + z);
                        }
                    });
                }

            });
        </script>
    </body>
</html>
